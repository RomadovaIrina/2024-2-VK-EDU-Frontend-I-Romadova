<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send a message</title>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


<link href="style.css" rel="stylesheet"></head>

<body>

    <style>
        /* Стиль для области чата */
        .messageBox {
            margin-top: 10px;
            padding: 10px;
            max-height: calc(100vh - 80px);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Сообщение */
        .message {
            background-color: white;
            padding: 10px;
            border-radius: 10px;
            max-width: 70%;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            word-wrap: break-word;
        }
        
        :root {
            --form-bg-color: rgb(201, 177, 248);
            --form-border-color: rgb(192, 171, 231);
            --form-box-shadow: 0px -2px 5px var(--form-bg-color);
            --form-border-radius: 20px;
            --transition-duration: 0.3s;
            --sendButton-color: rgb(142, 36, 170);
        }

        .form {
            display: flex;
            position: fixed;
            bottom: 0;
            padding: 15px;
            width: 100%;
            align-items: center;
            background-color: var(--form-bg-color);
            border-top: 2px solid var(--form-border-color);
            box-shadow: var(--form-box-shadow);
            z-index: 100;
        }


        .form-input {
            flex: 1;
            padding: 15px;
            border-radius: 20px;
            background-color: #ebe9ea;
            font-size: 20px;
            border: none;
            outline: none;
        }

        .sendButton {
            color: var(--sendButton-color);
            border: none;
            padding: 10px;
            margin-left: 5px;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }



        .sendButton:hover {
            background-color: var(--form-bg-color);
            cursor: pointer;
            
        }

        .material-icons {
            font-size: 30px;
        }
    </style>

    <form class="form" action="/">
        <input class="form-input" name="message-text" placeholder="Введите сообщение" type="text">
        <!-- Кнопка с иконкой отправки-->
        <button class="sendButton">
            <span class="material-icons">send</span>
        </button>
    </form>

    <div class="messageBox"></div>
    <!-- Тут будут сообщения в чатике -->

    <script>
        const form = document.querySelector('form');
        const input = document.querySelector('.form-input');

        const messageBox = document.querySelector('.messageBox');
        const sendButton = document.querySelector('.sendButton');
        const userName = 'Unknown'; // Заглушка для имени пользователя

        form.addEventListener('submit', handleSubmit);
        form.addEventListener('keypress', handleKeyPress);

        sendButton.addEventListener('click', (event) => {
            event.preventDefault();
            form.dispatchEvent(new Event('submit'));
        });

        const messagesStorage = JSON.parse(localStorage.getItem('chatMessages')) || [];

        function loadMessages() {
            messageBox.innerHTML = '';
            messagesStorage.forEach(function (messageData) {
                sendMessage(messageData, false);
            });
        }

        function handleSubmit(event) {
            event.preventDefault();
            const messageText = input.value.trim();
            const messageTime = new Date().toLocaleString();
            if (messageText) {
                const messageData = {
                    sender: userName,
                    text: messageText,
                    time: messageTime
                };
                messagesStorage.push(messageData);
                localStorage.setItem('chatMessages', JSON.stringify(messagesStorage));
                sendMessage(messageData);
                input.value = '';
            }
        }

        function handleKeyPress(event) {
            if (event.keyCode === 13) {
                form.dispatchEvent(new Event('submit'));
            }
        }

        function sendMessage(messageData) {

            const messageEl = document.createElement('div');
            messageEl.classList.add('message')
            messageEl.textContent = messageData.sender + ": " + messageData.text + " (" + messageData.time + ")";
            messageBox.appendChild(messageEl);

        }

        // Загрузка при открытии
        loadMessages();


    </script>
<script type="text/javascript" src="bundle.js"></script></body>

</html>